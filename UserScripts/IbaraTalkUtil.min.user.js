// ==UserScript==
// @name        IbaraTalkUtil
// @namespace   https://twitter.com/11powder
// @description 交流ってスバラシティ
// @include     http://lisge.com/ib/talk.php*
// @version     1.0.9.2
// @updateURL   https://pejuta.github.io/IbaraUtilities/UserScripts/IbaraTalkUtil.user.js
// @downloadURL https://pejuta.github.io/IbaraUtilities/UserScripts/IbaraTalkUtil.user.js
// @grant       none
// ==/UserScript==
!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=17)}([function(e,t){e.exports="<div class='Preview'><div class='Y3 PreviewHeader'>《{PREVIEW_TYPE}プレビュー》 <a href='#'> [Help] </a></div>{INNER_HTML}</div>"},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var i=(o=r,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),s=r.sources.map((function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"}));return[n].concat(s).concat([i]).join("\n")}var o;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},i=0;i<this.length;i++){var s=this[i][0];null!=s&&(r[s]=!0)}for(i=0;i<e.length;i++){var o=e[i];null!=o[0]&&r[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),t.push(o))}},t}},function(e,t,n){var r,i,s={},o=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=r.apply(this,arguments)),i}),a=function(e,t){return t?t.querySelector(e):document.querySelector(e)},l=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var r=a.call(this,e,n);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}}(),c=null,d=0,h=[],u=n(10);function f(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=s[r.id];if(i){i.refs++;for(var o=0;o<i.parts.length;o++)i.parts[o](r.parts[o]);for(;o<r.parts.length;o++)i.parts.push(w(r.parts[o],t))}else{var a=[];for(o=0;o<r.parts.length;o++)a.push(w(r.parts[o],t));s[r.id]={id:r.id,refs:1,parts:a}}}}function p(e,t){for(var n=[],r={},i=0;i<e.length;i++){var s=e[i],o=t.base?s[0]+t.base:s[0],a={css:s[1],media:s[2],sourceMap:s[3]};r[o]?r[o].parts.push(a):n.push(r[o]={id:o,parts:[a]})}return n}function v(e,t){var n=l(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=h[h.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),h.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=l(e.insertAt.before,n);n.insertBefore(t,i)}}function m(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=h.indexOf(e);t>=0&&h.splice(t,1)}function b(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var r=function(){0;return n.nc}();r&&(e.attrs.nonce=r)}return g(t,e.attrs),v(e,t),t}function g(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function w(e,t){var n,r,i,s;if(t.transform&&e.css){if(!(s="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=s}if(t.singleton){var o=d++;n=c||(c=b(t)),r=E.bind(null,n,o,!1),i=E.bind(null,n,o,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",g(t,e.attrs),v(e,t),t}(t),r=x.bind(null,n,t),i=function(){m(n),n.href&&URL.revokeObjectURL(n.href)}):(n=b(t),r=N.bind(null,n),i=function(){m(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=o()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=p(e,t);return f(n,t),function(e){for(var r=[],i=0;i<n.length;i++){var o=n[i];(a=s[o.id]).refs--,r.push(a)}e&&f(p(e,t),t);for(i=0;i<r.length;i++){var a;if(0===(a=r[i]).refs){for(var l=0;l<a.parts.length;l++)a.parts[l]();delete s[a.id]}}}};var y,S=(y=[],function(e,t){return y[e]=t,y.filter(Boolean).join("\n")});function E(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=S(t,i);else{var s=document.createTextNode(i),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(s,o[t]):e.appendChild(s)}}function N(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function x(e,t,n){var r=n.css,i=n.sourceMap,s=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||s)&&(r=u(r)),i&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var o=new Blob([r],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(o),a&&URL.revokeObjectURL(a)}},function(e,t){e.exports="<div style='position: absolute; z-index: 2;'><div class='SE3'><table cellpadding='0' cellspacing='0' class='SE0'><tr valign='TOP'>\r\n    <td width='70'><img src='p/iba_icon.png' class='RE2' alt='RE'></td>\r\n    <td class='F3'>\r\n        <a><span class='Y4'>{SCRIPT_NAME}の機能・使い方</span></a><br>\r\n            <div style='margin:10px;'>\r\n            ・入力した発言内容を自動的に解析してプレビューを表示します。<br>\r\n            ・<b class='O3'>Ctrl+Shift+Enterキー</b>を押すと、送信ボタンを押したのと同様にその発言内容を送信します。<br>\r\n            ・<b class='O3'>Tab</b>キーを押すと、欠けている装飾閉じタグ(<b class='Y3'>&lt;/B&gt;, &lt;/f4&gt;</b>など)を自動的に補完します。<br>\r\n            ・タグ名(<b class='Y3'>i4, S</b>など)を入力してからTabキーを押すと、指定の装飾タグを自動入力します。<br>\r\n            　<span class='P3'>例： f5 ⇒ &lt;f5&gt&lt;/f5&gt</span><br>\r\n            <br>　(hint) 入力自動補完に対応しているタグ名の一覧（小文字可、半角のみ）：<br><b class='Y3'>\r\n                　　 F[1-7] B B[1-7] I I[1-7] S S[1-7] U U[1-7]\r\n            </b>\r\n            </div>\r\n    </td>\r\n</tr></table></div></div>"},function(e,t){e.exports="<div class='{CNT_CLASS_NAME}'><table cellpadding='0' cellspacing='0' class='SE0'><tr valign='TOP'>\r\n   <td width='70'><img src='{ICON_URL}' class='RE2' alt='RE'></td>\r\n   <td class='F3'>\r\n       {RESPONSE}\r\n       <a href='#'><span class='Y3'>{SENDER_NAME}({SENDER_ENO})</span></a><br>{TALK_HTML}\r\n   </td>\r\n</tr></table></div>"},function(e,t){e.exports='<a href="talk.php?p={PLACE_ID}&amp;sno={TREE_ID}" target="_blank" class="F1">＞{RES_NAMES} <br></a>'},function(e,t){e.exports='<div class="{CLASS_NAME}">\r\n<table cellpadding="0" cellspacing="0" class="SE0"><tbody><tr valign="TOP"><td width="70" rowspan="2"><img src="{ICON_URL}" alt="RE" class="RE2"></td>\r\n<td class="F3"><a href="k/now/r{ENO}.html" target="_blank"><span class="Y3">{NAME}({ENO})</span></a><br>{RES_HTML}{BODY_HTML}</td></tr>\r\n<tr valign="BOTTOM"><td align="RIGHT" class="B1"><a href="./talk.php?p={PLACE_ID}" target="_blank"><span class="B1">at {PLACE_NAME}</span></a> {BR_IF_PLACENAME_LONG}({DATE})<a class="RE" style="display: none;" data-nn="{ID}"></a><a href="./talk.php?p={PLACE_ID}&sno={TREE_ID_OR_ID}" target="_blank"><span class="ShowTree">Jump</span></a></td></tr></tbody></table>\r\n</div>'},function(e,t){e.exports='<div id="FavLine">\r\n    <div id="FavLinePrev" class="BUT2"></div>\r\n    <div id="FavLineNav">\r\n        <div id="FavSearch">\r\n            <span>検索： </span>\r\n            <input type="text" class="TXT">\r\n            <select class="ARE">\r\n                <option value="0">降順</option>\r\n                <option value="1">昇順</option>\r\n            </select>\r\n        </div>\r\n        <div id="FavLineNext" class="BUT2"></div>\r\n    </div>\r\n    <div id="FavLineBody">\r\n        <div id="FavLeftLine"></div><div id="FavRightLine"></div>\r\n    </div>\r\n</div>'},function(e,t,n){var r=n(9);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,"@charset \"utf-8\";\r\n\r\ndiv.MXM > table[width='970']:first-of-type td[width='700'] {\r\n    /* say container */\r\n    max-width: 700px;\r\n    overflow: visible;\r\n}\r\n\r\ndiv.MXM > table[width='970']:first-of-type td[width='270'] {\r\n    /* say search */\r\n    vertical-align: top;\r\n    padding-top: 20px;\r\n}\r\n\r\n.SE3, .SE4 {\r\n    overflow: visible;\r\n    max-width: calc(100% - 20px);\r\n}\r\n\r\n.Preview .SE3, .Preview .SE4  {\r\n    max-width: initial;\r\n}\r\n",""])},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var i,s=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(s)?e:(i=0===s.indexOf("//")?s:0===s.indexOf("/")?n+s:r+s.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")}))}},function(e,t,n){var r=n(12);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,'@charset "utf-8";\r\n\r\n.OneColumn .SE3 > table, .OneColumn .SE4 > table {\r\n    width: 900px;\r\n}\r\n.TwoColumns .SE3 > table, .TwoColumns .SE4 > table {\r\n    width: 440px;\r\n}',""])},function(e,t,n){var r=n(14);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,'@charset "utf-8";\r\n\r\n.ShowTree {\r\n    font-size: 12px;\r\n    font-weight: bold;\r\n    color: #DDDD66;\r\n    cursor: pointer;\r\n    margin: 0 6px;\r\n    padding: 0 4px 0 3px;\r\n    background: #333300;\r\n    transition: 0.1s;\r\n    border: 1px solid #444400;\r\n}\r\n\r\n.ShowTree:hover {\r\n    color: #66CC33;\r\n}',""])},function(e,t,n){var r=n(16);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(2)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,'@charset "utf-8";\r\n\r\n#FavLineNav {\r\n    position: relative;\r\n    min-height: 1px;\r\n}\r\n\r\n#FavLinePrev, #FavLineNext {\r\n    display: inline-block;\r\n    width: 200px;\r\n    text-align: center;\r\n    position: absolute;\r\n}\r\n#FavLinePrev {\r\n    left: 15px;\r\n}\r\n#FavLineNext {\r\n    right: 15px;\r\n}\r\n\r\n#FavSearch {\r\n    position: absolute;\r\n    left: 0;\r\n    right: 0;\r\n    margin: auto;\r\n    width: 500px;\r\n    text-align: center;\r\n}\r\n\r\n#FavSearch > input {\r\n    width: 360px;\r\n}\r\n\r\n.ShowFavsBtn {\r\n    color: #DD4444;\r\n    background-color: black;\r\n    border: #661111 solid 1px;\r\n    border-radius: 3px;\r\n    margin-left: 6px;\r\n    padding: 2px 4px 0px 4px;\r\n    font-size: 13.5px;\r\n    line-height: 30px;\r\n    cursor: pointer;\r\n    white-space: nowrap;\r\n    transition: 0.1s;\r\n}\r\n.ShowFavsBtn:hover {\r\n    border-color: #992222;\r\n    background-color: #660000;\r\n    color: #FF6666;\r\n}\r\n.ShowFavsBtn.Shown {\r\n    color: #EE5555;\r\n    border-color: #992222;\r\n}\r\n\r\n.FavChat {\r\n    display: inline-block;\r\n    height: 18px;\r\n    width: 25px;\r\n    position: relative;\r\n    top: 1px;\r\n    left: 1px;\r\n    color: #DD4444;\r\n    border: #661111 solid 1px;\r\n    background-color: #110000;\r\n    font-weight: normal;\r\n    font-size: 16px;\r\n    line-height: 120%;\r\n    cursor: pointer;\r\n    transition: 0.1s;\r\n    margin: 0 7px 0 5px;\r\n    text-align: center;\r\n}\r\n.FavChat:before {\r\n    content: "\\2661";\r\n    display: inline-block;\r\n    height: 100%;\r\n    padding: 0 4px;\r\n}\r\n.FavChat:hover {\r\n    color: #FF6666;\r\n    border-color: #992222;\r\n    background-color: #660000;\r\n}\r\n\r\n.FavChat.Favd {\r\n    color: #EE5555;\r\n    border-color: #992222;\r\n    font-size: 17px;\r\n    line-height: 110%;\r\n    text-shadow: 0 0 4px red;\r\n}\r\n.FavChat.Favd:before {\r\n    content: "\\2665";\r\n}\r\n\r\n#FavLineBody {\r\n    margin-top: 42px;\r\n}\r\n\r\n#FavLeftLine, #FavRightLine {\r\n    float: left;\r\n    padding: 0px 12px;\r\n}\r\n.OneColumn #FavLeftLine, .OneColumn #FavRightLine {\r\n    width: 920px;\r\n}\r\n.TwoColumns #FavLeftLine, .TwoColumns #FavRightLine {\r\n    width: 460px;\r\n}\r\n.OneColumn #FavLeftLine {\r\n    border-right: none;\r\n}\r\n.TwoColumns #FavLeftLine {\r\n    border-right: 1px solid rgb(51, 51, 51);\r\n}',""])},function(e,t,n){"use strict";function r(e){return e?e.replace(/(?:\r\n|\r|\n)/g,"<BR>"):e}n.r(t);class i{constructor(){}enable(e,t){this.eventCallback=function(e){var t;this.value=(t=this.value)?t.replace(/<br>/gi,"\r\n"):t},t?$(e).on("keyup input",t,this.eventCallback):$(e).on("keyup input",this.eventCallback)}}const s={"&":"&amp;","'":"&#x27;",'"':"&quot;","`":"&#x60;","<":"&lt;",">":"&gt;"},o=new RegExp(`[${Object.keys(s).join("")}]`,"g");function a(e){return e.replace(o,e=>s[e])}const l=function e(t){const n=Object.getOwnPropertyNames(t);for(const r of n){const n=t[r];t[r]=n&&"object"==typeof n?e(n):n}return Object.freeze(t)}({F:{pattern:"F(?=\\d)",tagName:"span"},B:{pattern:"B",tagName:"b"},I:{pattern:"I",tagName:"i"},S:{pattern:"S",tagName:"s"},U:{pattern:"U",tagName:"u"}});let c=0;const d=[];for(const e in l)if(l.hasOwnProperty(e)){const t=l[e].pattern;c=t.length,d.push(t)}const h=c+1,u=d.join("|"),f="(?:"+u+")[1-7]?";function p(e,t,n,r){const i=l[t.toUpperCase()].tagName;return n?`<${i} class='F${n}'>${r}</${i}>`:`<${i}>${r}</${i}>`}const v=new RegExp(a("<"+("("+u+")([1-7]?)")+">(.*?)</\\1\\2>"),"ig");const m=new RegExp("<("+f+")>","gi"),b=new RegExp("</("+f+")>","gi"),g=new RegExp("<?("+f+")>?$","i"),w=new RegExp("</("+f+")>$","i"),y=new RegExp("</?([^>]{0,"+h+"}?)$"),S=new RegExp(f,"i");class E{constructor(){}enable(e,t){const n=this;this.eventCallback=function(e){n.autoCompleteTag(this,e)},t?$(e).on("keydown",t,this.eventCallback):$(e).on("keydown",this.eventCallback)}autoCompleteTag(e,t){if(9===t.which){if(t.preventDefault(),e.selectionEnd&&e.selectionStart!==e.selectionEnd)return void e.setSelectionRange(e.selectionEnd,e.selectionEnd);if(this.insertOrnamentTags(e))return;this.insertLastUnclosedTagEnd(e)}else"/"===t.key&&this.completeLastUnclosedTagEnd(e)&&t.preventDefault()}insertOrnamentTags(e){if("number"!=typeof e.selectionStart)return!1;if(e.selectionEnd&&e.selectionStart!==e.selectionEnd)return!1;const t=e.selectionStart,n=e.value.slice(0,t),r=e.value.slice(t),i=g.exec(n);if(!i)return!1;if(w.test(n))return!1;if(/^<[^<>]+?>$/.test(i[0]))return!1;const s=y.exec(n);if(s){const e=new RegExp("^([^<]{0,"+(h-s[1].length)+"}?)>").exec(r);if(e){if(S.test(s[1]+e[1]))return!1}}const o="<"+i[1]+"></"+i[1]+">";e.value=n.slice(0,-i[0].length)+o+r;const a=t-i[0].length+i[1].length+2;return e.setSelectionRange(a,a),!0}insertLastUnclosedTagEnd(e){if("number"!=typeof e.selectionStart)return!1;if(e.selectionEnd&&e.selectionStart!==e.selectionEnd)return!1;const t=e.selectionStart,n=e.value.slice(0,t),r=e.value.slice(t),i=this.findUnclosedTags(n,r);if(0===i.length)return!1;const s="</"+i[i.length-1]+">";return e.value=n+s+r,e.setSelectionRange(t,t+s.length),!0}findUnclosedTags(e,t){const n=e.match(m);if(!n)return[];const r=n.map((e,t)=>e.slice(1,e.length-1)),i=(e+t).match(b);if(!i)return r;const s=i.map((e,t)=>e.slice(2,e.length-1));for(let e=s.length-1;e>=0;e--)for(let t=r.length-1;t>=0;t--)if(s[e]===r[t]){r.splice(t,1);break}return r}completeLastUnclosedTagEnd(e){if("number"!=typeof e.selectionStart)return!1;if(e.selectionStart<=0||e.selectionStart!==e.selectionEnd)return!1;const t=e.selectionStart,n=e.value.slice(0,t),r=e.value.slice(t);if("<"!==n[t-1])return!1;const i=this.findUnclosedTags(n,r);if(0===i.length)return!1;const s="/"+i[i.length-1]+">";return e.value=n+s+r,e.setSelectionRange(t+1,t+s.length),!0}}class N{constructor(){}enable(e,t,n){let r="input[type='submit']";"string"==typeof n&&(r+="[value='"+n+"']");const i=this;this.eventCallback=function(e){const t=$(this).closest("form").find(r);i.submitWithCertainKeysDown(t,e)},t?$(e).on("keydown",t,this.eventCallback):$(e).on("keydown",this.eventCallback)}submitWithCertainKeysDown(e,t){13===t.which&&t.ctrlKey&&t.shiftKey&&(t.preventDefault(),e.first().click())}}var x=n(3),A=n.n(x),F="IbaraTalkUtil",T=1,I=5;function C(e,t){let n=e.toString();for(const e in t)void 0!==t[e]&&null!==t[e]&&(n=n.replace(new RegExp("{"+e+"}","g"),t[e].toString()));return n}class L{constructor(){this.attachedElement=null,this.$help=$(C(A.a,{SCRIPT_NAME:F}));const e=this;this.onClickHandler=function(t){t.preventDefault();const n=this;e.attachedElement===n?(e.$help.hide(),e.attachedElement=null):(e.$help.insertAfter(n).show(),e.attachedElement=n)}}enable(e,t){t?$(e).on("click",t,this.onClickHandler):$(e).on("click",this.onClickHandler),this.$help.on("click",()=>{this.$help.hide(),this.attachedElement=null})}}var _=n(0),O=n.n(_),R=n(4),D=n.n(R);class B{constructor(){this.id=0}setDelay(e,t,...n){this.id&&clearTimeout(this.id),arguments.length>=3?this.id=setTimeout(t=>{e.apply(null,t),this.id=0},t,n):this.id=setTimeout(()=>{e.call(null),this.id=0},t)}}function M(e){if(!e)return e;const t=/^[ \r\n\t]*([\s\S]*?)\s*$/.exec(e);return t?t[1]:e}n(8);class k extends class{constructor(e){this.delayMS=e,this.delayer=new B,this.eventCallback=t=>{this.delayer.setDelay(()=>this.previewEvent(t),e,t)}}static formatPreviewHtml(e,t){const n=t.extraFormatArg||{};return C(e,$.extend(n,{CHARS:t.chars,MAX_CHARS:t.maxChars,PREVIEW_TYPE:t.previewType}))}static buildPreviewParentBlock(e){return $("<div class='PreviewParentBlock' name='Preview' />").addClass(e)}static insertPreview(e,t){let n=e.next(".PreviewParentBlock");return 0===n.length&&(n=this.buildPreviewParentBlock(t).insertAfter(e)),n}static appendPreview(e,t){var n=e.find(".PreviewParentBlock");return 0===n.length&&(n=this.buildPreviewParentBlock(t).appendTo(e)),n}static updateTalkPreview(e){const t=this.insertPreview(e.$insertAfter,e.styleName),n=M(e.$text.val());if(0===n.length)return void t.css("display","none");if(n.length>e.maxChars)return void t.html(this.formatPreviewHtml(C(O.a,{INNER_HTML:"<div class='SE2'>【ERROR】書き込み内容は{MAX_CHARS}文字以内です！（現在{CHARS}文字）</div>"}),{chars:n.length,maxChars:e.maxChars,previewType:"発言"})).css("display","block");const i=M(e.$name.val());if(i.length>8)return void t.html(this.formatPreviewHtml(C(O.a,{INNER_HTML:"<div class='Preview'><div class='SE2'>【ERROR】発言者名は{MAX_CHARS}文字以内です！（現在{CHARS}文字）</div></div>"}),{chars:i.length,maxChars:8,previewType:"発言"})).css("display","block");let s=a(i),o=n;const l=/^@([\s\S]*?)@/.exec(o);l&&(l[1]&&(s=r(a(l[1]))),o=o.substring(l[0].length)),o=function(e){let t=a(e);t=r(t).replace(/&lt;br&gt;/gi,"<BR>");for(let e=0;e<2;e++)t=t.replace(/&lt;(([1-9][0-9]?)D([1-9][0-9]?[0-9]?))&gt;/i,"<span class='DX'>【 <b>$1</b>：[$2個の$3面ダイスを振る] 】</span>");return function(e,t,n){let r=e.toString();for(;;){if(!t.test(r))return r;r=r.replace(t,n)}}(t,v,p)}(o);const c=e.$icon.val();let d="p/nii.png";/^\d+$/.test(c)&&(d=e.iconUrls[parseInt(c,10)]);const h=this.formatPreviewHtml(e.template,{chars:n.length,maxChars:e.maxChars,previewType:"発言",extraFormatArg:{ICON_URL:d,SENDER_NAME:s,TALK_HTML:o}});t.html(h).css("display","block")}}{constructor(e){super(e),this.delayMS=e,this.iconUrls=k.extractOrLoadIconUrlArray(),this.userENo=(/IBR_KEY=.+?_(\d+)(?:;|$)/.exec(document.cookie)||[])[1]||null}enable(){$(document.body).on("keyup input","textarea[name^='dt_mes']",this.eventCallback).on("keyup input","input[name^='dt_ai']",this.eventCallback).on("change","select[name^='dt_ic']",this.eventCallback)}previewEvent(e){const t=$(e.currentTarget).parent("form"),n=this.formatTalkTemplate(t),r={$insertAfter:t,$text:t.find("textarea[name^='dt_mes']"),$name:t.find("input[name^='dt_ai']"),$icon:t.find("select[name^='dt_ic']"),template:n,maxChars:400,iconUrls:this.iconUrls,styleName:"Talk"};k.updateTalkPreview(r)}formatTalkTemplate(e){let t="SE3",n="";k.isResponseForm(e)&&(t="SE4",n="<a class='F1' href='#'>＞返信 <br></a>");const r=C(D.a,{CNT_CLASS_NAME:t,RESPONSE:n,SENDER_ENO:this.userENo});return C(O.a,{INNER_HTML:r})}static extractOrLoadIconUrlArray(){return $("#CL1 img.IC").get().map(e=>{var t;return null!=(t=e.getAttribute("src"))?t:""})}static isResponseForm(e){return"say"!==e.attr("name")}}n(11);class P{constructor(){}enable(){const e=$("#PLSBN3").parent("a"),t=e.prop("onclick"),n=this;this.eventCallback=function(e){t.call(this,e),n.switchColumnClass(this)},e.prop("onclick","").on("click",this.eventCallback),this.switchColumnClass(e[0])}switchColumnClass(e){2===(-1===e.textContent.indexOf("２列")?2:1)?$("div.MXM").addClass(P.CLASSNAME_TWO_COLUMNS).removeClass(P.CLASSNAME_ONE_COLUMN):$("div.MXM").addClass(P.CLASSNAME_ONE_COLUMN).removeClass(P.CLASSNAME_TWO_COLUMNS)}}P.CLASSNAME_ONE_COLUMN="OneColumn",P.CLASSNAME_TWO_COLUMNS="TwoColumns";var U=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))};class j{constructor(e){this.db=null,this.dbName=e.dbName,this.tableName=e.tableName,this.dbVersion=e.dbVersion,e.optionalParameters&&(this.optionalParameters=Object.freeze(Object.assign({},e.optionalParameters)))}get DBPromise(){return this.dbPromise}get DBIsOpen(){return!!this.db}open(e){const t=indexedDB.open(this.dbName,this.dbVersion);return this.dbPromise=new Promise((n,r)=>{const i=this;t.onsuccess=function(e){i.db=this.result,n(i.db)},t.onerror=function(e){i.db=null,r("db error")},t.onupgradeneeded=function(t){const n=this.result;if(e)e(n,t);else{n.createObjectStore(i.tableName,i.optionalParameters)}}})}close(){var e;null===(e=this.db)||void 0===e||e.close()}count(e){if(!this.db)throw this.throwDBIsNotReadyError();const t=this.db.transaction(this.tableName,"readonly").objectStore(this.tableName).count(e);return new Promise((e,n)=>{t.onsuccess=function(t){e(this.result)},t.onerror=function(e){n("db error")}})}get(e){if(!this.db)throw this.throwDBIsNotReadyError();const t=this.db.transaction(this.tableName,"readonly").objectStore(this.tableName).get(e);return new Promise((e,n)=>{t.onsuccess=function(t){e(this.result)},t.onerror=function(e){n("db error")}})}getAll(e,t){if(!this.db)throw this.throwDBIsNotReadyError();const n=this.db.transaction(this.tableName,"readonly").objectStore(this.tableName).getAll(e,t);return new Promise((e,t)=>{n.onsuccess=function(t){e(this.result)},n.onerror=function(e){t("db error")}})}getAllDescending(e,t){return U(this,void 0,void 0,(function*(){const n=[];if(void 0===t)return yield this.iterate(e=>(n.push(e),!1),e,"prev"),n;let r=t;return r<=0?n:(yield this.iterate(e=>(n.push(e),0==--r),e,"prev"),n)}))}getKey(e){if(!this.db)throw this.throwDBIsNotReadyError();const t=this.db.transaction(this.tableName,"readonly").objectStore(this.tableName).getKey(e);return new Promise((e,n)=>{t.onsuccess=function(t){e(this.result)},t.onerror=function(e){n("db error")}})}getAllKeys(e,t){if(!this.db)throw this.throwDBIsNotReadyError();const n=this.db.transaction(this.tableName,"readonly").objectStore(this.tableName).getAllKeys(e,t);return new Promise((e,t)=>{n.onsuccess=function(t){e(this.result)},n.onerror=function(e){t("db error")}})}add(e,t){if(!this.db)throw this.throwDBIsNotReadyError();const n=this.db.transaction(this.tableName,"readwrite").objectStore(this.tableName);return this.addOne(n,e,t)}bulkAdd(e){return U(this,void 0,void 0,(function*(){if(!this.db)throw this.throwDBIsNotReadyError();if(0===e.length)return[];const t=this.db.transaction(this.tableName,"readwrite").objectStore(this.tableName),n=[];for(const r of e)n.push(yield this.addOne(t,r));return n}))}put(e,t){if(!this.db)throw this.throwDBIsNotReadyError();const n=this.db.transaction(this.tableName,"readwrite").objectStore(this.tableName);return this.putOne(n,e,t)}bulkPut(e){return U(this,void 0,void 0,(function*(){if(!this.db)throw this.throwDBIsNotReadyError();if(0===e.length)return[];const t=this.db.transaction(this.tableName,"readwrite").objectStore(this.tableName),n=[];for(const r of e)n.push(yield this.putOne(t,r));return n}))}delete(e){if(!this.db)throw this.throwDBIsNotReadyError();const t=this.db.transaction(this.tableName,"readwrite").objectStore(this.tableName);return this.deleteOne(t,e)}bulkDelete(e){return U(this,void 0,void 0,(function*(){if(!this.db)throw this.throwDBIsNotReadyError();if(0===e.length)return;const t=this.db.transaction(this.tableName,"readwrite").objectStore(this.tableName);for(const n of e)yield this.deleteOne(t,n)}))}clear(){if(!this.db)throw this.throwDBIsNotReadyError();const e=this.db.transaction(this.tableName,"readwrite").objectStore(this.tableName).clear();return new Promise((t,n)=>{e.onsuccess=function(e){t()},e.onerror=function(e){n("db error")}})}openCursor(e,t,n){if(!this.db)throw this.throwDBIsNotReadyError();return this.db.transaction(this.tableName,n).objectStore(this.tableName).openCursor(e,t)}openKeyCursor(e,t,n){if(!this.db)throw this.throwDBIsNotReadyError();return this.db.transaction(this.tableName,n).objectStore(this.tableName).openKeyCursor(e,t)}iterate(e,t,n,r){const i=this.openCursor(t,n,r);return new Promise((t,n)=>{i.onsuccess=function(n){const r=this.result;r?e(r.value,r)?t():r.continue():t()},i.onerror=function(e){n("db error")}})}iterateKey(e,t,n,r){const i=this.openKeyCursor(t,n,r);return new Promise((t,n)=>{i.onsuccess=function(n){const r=this.result;r?e(r.key,r)?t():r.continue():t()},i.onerror=function(e){n("db error")}})}addOne(e,t,n){const r=e.add(t,n);return new Promise((e,t)=>{r.onsuccess=function(t){e(this.result)},r.onerror=function(e){t("db error")}})}putOne(e,t,n){const r=e.put(t,n);return new Promise((e,t)=>{r.onsuccess=function(t){e(this.result)},r.onerror=function(e){t("db error")}})}deleteOne(e,t){if(!this.db)throw this.throwDBIsNotReadyError();const n=e.delete(t);return new Promise((e,t)=>{n.onsuccess=function(t){e()},n.onerror=function(e){t("db error")}})}throwDBIsNotReadyError(){throw new Error("DBの準備が完了していません。Promiseを参照してDBが開けるまで待機してください。")}}const H=new RegExp(`^\\d{1,${I}}$`);class V{constructor(e){this.id=e.id,this.treeId=e.treeId,this.eno=e.eno,this.resNames=e.resNames,this.name=e.name,this.iconUrl=e.iconUrl,this.placeId=e.placeId,this.placeName=e.placeName,this.date=e.date,this.bodyHtml=e.bodyHtml,this.trueId=V.toTrueId(this.id)}static toTrueId(e){return e%1e3*1e7+Math.floor(e/1e3)}static toId(e){return e%1e7*1e3+Math.floor(e/1e7)}static matchFavItem(e,t){if(!e)return!0;if(H.exec(e)){return parseInt(e,10)===t.eno||!!t.resNames&&-1!==t.resNames.indexOf(`(${e})`)}const n=e.toLowerCase();return-1!==t.name.toLowerCase().indexOf(n)||!!t.resNames&&-1!==t.resNames.indexOf(e)||-1!==t.placeName.toLowerCase().indexOf(n)||-1!==t.bodyHtml.toLowerCase().indexOf(n)}}var W=function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))};class K{constructor(){this.table=new j({dbName:F,dbVersion:T,tableName:"FavData",optionalParameters:{autoIncrement:!1,keyPath:"trueId"}}),this.table.dbVersion>=1&&this.table.open()}get DBPromise(){return new Promise((e,t)=>{this.table.DBPromise.then(()=>e(),e=>t(e))})}get DBIsOpen(){return this.table.DBIsOpen}addFav(e){return this.table.put(e)}deleteFav(e){return this.table.delete(V.toTrueId(e))}takeFrom(e=null,t,n){return W(this,void 0,void 0,(function*(){let r;return r="number"==typeof e?yield this.table.getAll(IDBKeyRange.lowerBound(V.toTrueId(e),!!t),n):yield this.table.getAll(null,n),r}))}takeLastFrom(e=null,t,n){return W(this,void 0,void 0,(function*(){let r;return r="number"==typeof e?yield this.table.getAllDescending(IDBKeyRange.upperBound(V.toTrueId(e),!!t),n):yield this.table.getAllDescending(null,n),r}))}contains(e){return W(this,void 0,void 0,(function*(){let t=!1;const n=V.toTrueId(e);return yield this.table.iterateKey(e=>(t=!0,!0),n,"prev"),t}))}intersect(e){return W(this,void 0,void 0,(function*(){if(0===e.length)return[];const t=e.map(V.toTrueId).sort((e,t)=>t-e);let n=t.shift();const r=[];return yield this.table.iterateKey(e=>{for(;n>=e;){if(n===e&&r.push(V.toId(n)),0===t.length)return!0;n=t.shift()}return!1},null,"prev"),r}))}search(e,t=null,n,r,i){return W(this,void 0,void 0,(function*(){const s=[];let o=null;if("number"==typeof t&&(o=i&&i.startsWith("prev")?IDBKeyRange.upperBound(V.toTrueId(t),!!n):i&&i.startsWith("next")?IDBKeyRange.lowerBound(V.toTrueId(t),!!n):t),"number"!=typeof r)yield this.table.iterate(t=>{V.matchFavItem(e,t)&&s.push(t)},o,i);else{if(r<=0)return[];let t=r;yield this.table.iterate(n=>{if(V.matchFavItem(e,n)&&(s.push(n),0==--t))return!0},o,i)}return s}))}}var Y=n(5),q=n.n(Y),X=n(6),z=n.n(X),G=n(7),J=n.n(G),Q=(n(13),n(15),function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))});class Z{constructor(){this.eventCallback=null,this.$frame=null,this.$regularLineElements=$("#LEFTLINE,#RIGHTLINE,form[name='nex'],form[name='bef']"),this.maxShownFavs=Z.initialShownFavs,this.$showFavsBtn=$(`<span class="${Z.CLASSNAME_SHOW_FAVS_BUTTON}">お気に入り</span>`),this.searchDelayer=new B,this.searchingPromise=null,this.db=new K}enable(e){return Q(this,void 0,void 0,(function*(){yield this.db.DBPromise,yield this.addFavButtons(e);const t=this,n=function(e){t.toggleFav(this)};this.eventCallback=n,$(e).on("click","."+Z.CLASSNAME_FAV_BUTTON,n),this.$showFavsBtn.insertAfter($(".BUTT3 > img").parent().parent("a").next("a").next("a")).on("click",()=>this.toggleFavTimeLine())}))}toggleFav(e){if(e.classList.contains(Z.CLASSNAME_FAV_BUTTON_FAVD)){const t=parseInt(e.dataset[Z.DATANAME_FAV_BUTTON_ID],10);this.db.deleteFav(t),e.classList.remove(Z.CLASSNAME_FAV_BUTTON_FAVD)}else{const t=this.buildFavItem(e);this.db.addFav(t),e.classList.add(Z.CLASSNAME_FAV_BUTTON_FAVD)}this.toggleButtonsWithTheSameID(e)}toggleButtonsWithTheSameID(e){if(this.$frame&&$(e).closest(this.$frame).length>0){const t=e.dataset[Z.DATANAME_FAV_BUTTON_ID],n=$(e.ownerDocument).find("."+Z.CLASSNAME_FAV_BUTTON).filter((function(){return this!==e&&this.dataset[Z.DATANAME_FAV_BUTTON_ID]===t}));n.length>0&&n.each((e,t)=>{t.classList.toggle(Z.CLASSNAME_FAV_BUTTON_FAVD)})}}addFavButtons(e,t=!1){return Q(this,void 0,void 0,(function*(){const n=$(e).find("a.RE"),r=n.get().map(e=>{var t;return parseInt(null!=(t=e.getAttribute("nn"))?t:e.dataset.nn,10)});let i=null;return t||(i=new Set(yield this.db.intersect(r))),n.each((e,n)=>{const s=$(`<span class="${Z.CLASSNAME_FAV_BUTTON}"></span>`).insertBefore(n);s[0].dataset[Z.DATANAME_FAV_BUTTON_ID]=r[e].toString(),(t||i.has(r[e]))&&s.addClass(Z.CLASSNAME_FAV_BUTTON_FAVD)}).prev()}))}buildFavItem(e){const t=parseInt(e.dataset[Z.DATANAME_FAV_BUTTON_ID],10);let n;const r=e.parentElement.childNodes[1],i=e.parentElement.childNodes[2],s=e.parentElement.childNodes[3];n=3===r.nodeType&&" "===r.textContent&&1===i.nodeType&&"br"===i.tagName.toLowerCase()?s:r;const o=/\((.+?)\)/.exec(n.textContent),a=o?o[1]:"",l=e.parentElement.firstElementChild.textContent.substring(3),c=$(e).closest("table").find("tr:first"),d=c.find("td:first>img")[0],h=parseInt(d.getAttribute("snn"),10),u=parseInt(d.getAttribute("no"),10),f=parseInt(d.getAttribute("pl"),10),p=d.getAttribute("src"),v=c.find("td:eq(1)").clone(),m=v.contents();let b,g=null;m.eq(0).is("a.F1")?(g=m.eq(0).text().slice(1,-1),m.eq(0).remove(),b=m.eq(1)):b=m.eq(0);const w=b.text().slice(0,-(u.toString().length+2));b.remove(),v.children().first().remove();const y=v.html();return v.remove(),new V({id:t,treeId:h,eno:u,placeId:f,placeName:l,date:a,iconUrl:p,resNames:g,name:w,bodyHtml:y})}toggleFavTimeLine(){return Q(this,void 0,void 0,(function*(){if(this.$showFavsBtn.toggleClass(Z.CLASSNAME_SHOW_FAVS_BUTTON_SHOWN),this.$frame&&"none"!==this.$frame.css("display"))return this.$frame.fadeOut(Z.animationFadeMS),void this.$regularLineElements.fadeIn(Z.animationFadeMS);if(this.maxShownFavs<=0)return;this.$frame||(this.$frame=this.insertFavTimeLineElements()),this.$frame.show();const e=yield this.takeFirstEnoughFavItems();yield this.overwriteFavItemsOnFavTimeLine(e),this.$regularLineElements.fadeOut(Z.animationFadeMS)}))}insertFavTimeLineElements(){const e=$(J.a).insertBefore("#LEFTLINE");this.$favTimeLineOrdering=$("#FavSearch > select").val(this.checkIfOrderingIsAscending()?"1":"0"),this.$frame=e;return e.find("#FavLinePrev").html(`前の${this.maxShownFavs}件を表示`).on("click",()=>this.toPrevOfFavTimeLine()),e.find("#FavLineNext").html(`次の${this.maxShownFavs}件を表示`).on("click",()=>this.toNextOfFavTimeLine()),this.enableSearch(),e}takeFirstEnoughFavItems(){return Q(this,void 0,void 0,(function*(){const e=this.getSearchWordValue();return this.checkIfOrderingIsAscending()?yield this.db.search(e,null,null,this.maxShownFavs,"next"):yield this.db.search(e,null,null,this.maxShownFavs,"prev")}))}toNextOfFavTimeLine(){return Q(this,void 0,void 0,(function*(){const e=this.currentFavItems.map(e=>e.trueId),t=this.getSearchWordValue();let n;n=this.checkIfOrderingIsAscending()?yield this.db.search(t,V.toId(Math.max(...e)),!0,this.maxShownFavs,"next"):yield this.db.search(t,V.toId(Math.min(...e)),!0,this.maxShownFavs,"prev"),0!==n.length&&(yield this.overwriteFavItemsOnFavTimeLine(n))}))}toPrevOfFavTimeLine(){return Q(this,void 0,void 0,(function*(){const e=this.currentFavItems.map(e=>e.trueId),t=this.getSearchWordValue();let n;if(n=this.checkIfOrderingIsAscending()?(yield this.db.search(t,V.toId(Math.min(...e)),!0,this.maxShownFavs,"prev")).reverse():(yield this.db.search(t,V.toId(Math.max(...e)),!0,this.maxShownFavs,"next")).reverse(),0!==n.length){if(n.length<this.maxShownFavs){if(this.currentFavItems.length<this.maxShownFavs)return;const e=this.currentFavItems.slice().sort((e,t)=>e.trueId-t.trueId);let t;this.checkIfOrderingIsAscending()?(t=e.slice(0,this.maxShownFavs-n.length),n=n.concat(t)):(t=e.reverse().slice(0,this.maxShownFavs-n.length),n=t.concat(n))}yield this.overwriteFavItemsOnFavTimeLine(n)}}))}overwriteFavItemsOnFavTimeLine(e){return Q(this,void 0,void 0,(function*(){if(!this.$frame)throw new Error("invalid operation");this.currentFavItems=e;const t=e.map(this.formatFav),n=Math.ceil(this.maxShownFavs/2),r=[$(document.createDocumentFragment()),$(document.createDocumentFragment())];for(let e=0;e<t.length;++e)e<n?r[0].append(t[e]):r[1].append(t[e]);const i=this.$frame.find("#FavLeftLine"),s=this.$frame.find("#FavRightLine"),o=i.children(),a=s.children();i.prepend(r[0]),s.prepend(r[1]),o.remove(),a.remove(),this.$frame.find("#FavLineBody").hide().fadeIn(Z.animationFadeMS),yield this.addFavButtons(this.$frame[0],!0)}))}enableSearch(){return Q(this,void 0,void 0,(function*(){if(!this.$frame||!this.$favTimeLineOrdering)throw new Error("invalid operation");const e=this.$frame.find("#FavSearch > input"),t=()=>{const t=this.searchingPromise;this.searchingPromise=(()=>Q(this,void 0,void 0,(function*(){if(!this.$frame)throw new Error("invalid operation");const n=e.val();if(t&&(yield t),n!==e.val())return;const r=this.checkIfOrderingIsAscending()?"next":"prev",i=yield this.db.search(n,null,null,this.maxShownFavs,r);yield this.overwriteFavItemsOnFavTimeLine(i),this.searchingPromise=null})))()};e.on("input",e=>{13===e.keyCode?(e.preventDefault(),this.searchDelayer.setDelay(t,0)):this.searchDelayer.setDelay(t,Z.searchDelayMS)}),this.$favTimeLineOrdering.on("change",e=>{this.searchDelayer.setDelay(t,100)})}))}getSearchWordValue(){return this.$frame&&"none"!==this.$frame.css("display")?this.$frame.find("#FavSearch > input").val():""}checkIfOrderingIsAscending(){return this.$frame&&"none"!==this.$frame.css("display")?"1"===this.$frame.find("#FavSearch > select").val():Z.initiallyOrderedByAscending}formatFav(e){let t,n;e.resNames?(t="SE4",n=q.a):(t="SE3",n="");const r=C(z.a,{RES_HTML:n});return C(r,{CLASS_NAME:t,ID:e.id,TREE_ID:e.treeId,PLACE_NAME:e.placeName,BR_IF_PLACENAME_LONG:e.placeName.length>=10?"<br>":"",NAME:e.name,ENO:e.eno,PLACE_ID:e.placeId,ICON_URL:e.iconUrl,DATE:e.date,RES_NAMES:e.resNames,BODY_HTML:e.bodyHtml,TREE_ID_OR_ID:0===e.treeId?e.id:e.treeId})}}Z.animationFadeMS=400,Z.searchDelayMS=200,Z.CLASSNAME_FAV_BUTTON="FavChat",Z.CLASSNAME_FAV_BUTTON_FAVD="Favd",Z.CLASSNAME_SHOW_FAVS_BUTTON="ShowFavsBtn",Z.CLASSNAME_SHOW_FAVS_BUTTON_SHOWN="Shown",Z.DEFAULT_SHOWN_FAVS=10,Z.initialShownFavs=parseInt($("input[name='dt_kz']").attr("value")||Z.DEFAULT_SHOWN_FAVS.toString(),10),Z.initiallyOrderedByAscending="1"===$("select[name='dt_jn'] > option").filter((function(){return!!$(this).attr("selected")})).val(),Z.DATANAME_FAV_BUTTON_ID="id",(()=>{if(!document.getElementById("CL1"))return;const e=new i,t=new E,n=new N,r=new L,s=new k(200),o=new P,a=new Z;e.enable(document.body,"textarea[name^='dt_mes']"),n.enable(document.body,"textarea[name^='dt_mes']","発言する"),t.enable(document.body,"textarea[name^='dt_mes']"),r.enable(document.body,".PreviewHeader"),s.enable(),o.enable(),a.enable(document.body)})()}]);
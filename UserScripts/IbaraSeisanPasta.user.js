// ==UserScript==
// @name        IbaraSeisanPasta
// @namespace   Pejuta
// @description イバラシティの生産をパスタする
// @include     http://lisge.com/ib/act_trade.php*
// @version     1.1.10
// @grant       none
// ==/UserScript==
!function(n){var r={};function o(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}o.m=n,o.c=r,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=7)}([function(t,e){t.exports=jQuery},function(t,e){t.exports='<div id="ISP_Info" class="Y2">--茨街生産パスタ-- <span class="W2">表示形式:\r\n<select id="ISP_OutputFormat" class="ARE">\r\n<option value="0">最短</option>\r\n<option value="1">簡易</option>\r\n<option value="2">詳細</option>\r\n<option value="3">公式</option>\r\n</select></span> <input type="button" value="キャラ情報取得" class="BUT F1" id="ISP_BtnItemNames"> <a id="ISP_HelpLink" class="R2">[HELP]</a>\r\n<div id="ISP_HelpBody" class="W2"><b class="W3">当ツールは生産仕様の伝達や、生産入力を補助する目的で作られました。</b>\r\n\r\n<span class="O2">以下ではこのツールに適合する生産仕様テキストのことを<b class="Y2">パスタ</b>と呼びます。</span>\r\n\r\n<b class="R2">«パスタの生成»</b>\r\n各生産に必要な情報をすべて正しく入力すると、パスタが自動的に生成され表示されます。\r\nパスタは生産内容の確認や他プレイヤーへの生産内容伝達に使用できます。\r\n<span class="O2">\r\n[武器/防具/装飾]の三種以外の作製の場合、それが武器生産の一種であるか否かを自動で判別しません。\r\nその場合に出力されるパスタには<b> ../武器なら射程1</b> といった射程情報が自動で付与されますが、\r\n武器の場合は<b>"武器なら"</b>の部分、武器以外の場合は<b>射程情報全体</b>を消去すると可読性が向上します。\r\n</span>\r\n<b class="R2">«生産の自動入力»</b>\r\n<b>ENo.入力欄</b>に有効なパスタを<b>貼り付け(ペースト)</b>すると、その内容から生産を自動入力します。\r\nまた、パスタに加え<b>【▼最新の送信内容をざっくり確認】のコピーからも自動入力が行えます。</b>\r\n（武器や料理などアイテム名を指定する生産の場合には複数行の貼り付けが必要です。）\r\n\r\n<b class="Y2">【有効なパスタの例】</b>各1行がそれぞれ1つのパスタを表します。\r\n<span class="P2">-作製</span>\r\n[装備作製]ENo.6789/ItemNo.1/防具/ころも/武器なら射程3\r\n[作製]ENo.6789/ItemNo.1/武器/こんぼう/射程1\r\n[作製]ENo.6789/ItemNo.1/防具/ころも\r\n6789/1/装飾/ゆびわ\r\n\r\n<span class="P2">-付加</span>\r\n[効果付加]ENo.6789/ItemNo.1/ItemNo.2\r\n[付加]6789/1/2\r\n6789/1/2/付加\r\n\r\n<span class="P2">-合成</span>\r\n[合成実験]ENo.6789/ItemNo.1/ItemNo.2/合成実験\r\n[合成]ENo.6789/ItemNo.1/ItemNo.2\r\n[合成実験]6789/1/2\r\n6789/1/2/合成\r\n\r\n<span class="P2">-料理</span>\r\n[料理]ENo.6789/ItemNo.1/料理/たまごやき\r\n6789/1/料理/たまごやき</span>\r\n</div></div>'},function(t,e,n){var r=n(3);"string"==typeof r&&(r=[[t.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(5)(r,o);r.locals&&(t.exports=r.locals)},function(t,e,n){(t.exports=n(4)(!1)).push([t.i,'#ISP_Info {\r\n    display: inline-block;\r\n    width: 400px;\r\n    text-align: right;\r\n    position: relative;\r\n}\r\n#ISP_HelpBody {\r\n    display: none;\r\n    overflow-y: scroll;\r\n    height: 480px;\r\n    width: 640px;\r\n    text-align: left;\r\n    white-space: pre-wrap;\r\n    background-color: rgba(51, 2, 18, 0.95);\r\n    padding: 10px;\r\n    position: absolute;\r\n    right: 0;\r\n}\r\n#ISP_HelpLink:hover + #ISP_HelpBody, #ISP_HelpBody:hover {\r\n    display: block;\r\n}\r\ninput[name^="dt_seieno"] {\r\n    background-color: blanchedalmond;\r\n    border: double gray;\r\n}\r\n.Seisanpasta {\r\n    background-color: transparent;\r\n    border-width: 0;\r\n    color: #AA88AA;\r\n    font-family: Meiryo,sans-serif;\r\n    font-size: 14px;\r\n    margin: 4px 4px 0px;\r\n    overflow-y: hidden;\r\n    white-space: pre-wrap;\r\n    width: calc(100% - 100px);\r\n}\r\n.Seisanpasta.Error {\r\n    color: #CC3333;\r\n    font-weight: bold;\r\n}\r\n.Seisanpasta:focus {\r\n    outline: 0;\r\n}\r\n.ISP_tooltip {\r\n    display: none;\r\n    font-size: 12px;\r\n}\r\n.Seisanpasta:focus+.ISP_tooltip {\r\n    display: block;\r\n    position: absolute;\r\n    margin-left: 8px;\r\n}',""])},function(t,e,n){"use strict";t.exports=function(n){var a=[];return a.toString=function(){return this.map(function(t){var e=function(t,e){var n=t[1]||"",r=t[3];if(!r)return n;if(e&&"function"==typeof btoa){var o=(a=r,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),i=r.sources.map(function(t){return"/*# sourceURL="+r.sourceRoot+t+" */"});return[n].concat(i).concat([o]).join("\n")}var a;return[n].join("\n")}(t,n);return t[2]?"@media "+t[2]+"{"+e+"}":e}).join("")},a.i=function(t,e){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},r=0;r<this.length;r++){var o=this[r][0];null!=o&&(n[o]=!0)}for(r=0;r<t.length;r++){var i=t[r];null!=i[0]&&n[i[0]]||(e&&!i[2]?i[2]=e:e&&(i[2]="("+i[2]+") and ("+e+")"),a.push(i))}},a}},function(t,e,r){var n,o,i,u={},p=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=n.apply(this,arguments)),o}),a=(i={},function(t,e){if("function"==typeof t)return t();if(void 0===i[t]){var n=function(t,e){return e?e.querySelector(t):document.querySelector(t)}.call(this,t,e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}i[t]=n}return i[t]}),c=null,l=0,s=[],m=r(6);function f(t,e){for(var n=0;n<t.length;n++){var r=t[n],o=u[r.id];if(o){o.refs++;for(var i=0;i<o.parts.length;i++)o.parts[i](r.parts[i]);for(;i<r.parts.length;i++)o.parts.push(_(r.parts[i],e))}else{var a=[];for(i=0;i<r.parts.length;i++)a.push(_(r.parts[i],e));u[r.id]={id:r.id,refs:1,parts:a}}}}function d(t,e){for(var n=[],r={},o=0;o<t.length;o++){var i=t[o],a=e.base?i[0]+e.base:i[0],s={css:i[1],media:i[2],sourceMap:i[3]};r[a]?r[a].parts.push(s):n.push(r[a]={id:a,parts:[s]})}return n}function h(t,e){var n=a(t.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=s[s.length-1];if("top"===t.insertAt)r?r.nextSibling?n.insertBefore(e,r.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),s.push(e);else if("bottom"===t.insertAt)n.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=a(t.insertAt.before,n);n.insertBefore(e,o)}}function y(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=s.indexOf(t);0<=e&&s.splice(e,1)}function g(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var n=function(){0;return r.nc}();n&&(t.attrs.nonce=n)}return N(e,t.attrs),h(t,e),e}function N(e,n){Object.keys(n).forEach(function(t){e.setAttribute(t,n[t])})}function _(e,t){var n,r,o,i,a,s;if(t.transform&&e.css){if(!(i="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=i}if(t.singleton){var u=l++;n=c||(c=g(t)),r=I.bind(null,n,u,!1),o=I.bind(null,n,u,!0)}else o=e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(a=t,s=document.createElement("link"),void 0===a.attrs.type&&(a.attrs.type="text/css"),a.attrs.rel="stylesheet",N(s,a.attrs),h(a,s),r=function(t,e,n){var r=n.css,o=n.sourceMap,i=void 0===e.convertToAbsoluteUrls&&o;(e.convertToAbsoluteUrls||i)&&(r=m(r));o&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var a=new Blob([r],{type:"text/css"}),s=t.href;t.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}.bind(null,n=s,t),function(){y(n),n.href&&URL.revokeObjectURL(n.href)}):(n=g(t),r=function(t,e){var n=e.css,r=e.media;r&&t.setAttribute("media",r);if(t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}.bind(null,n),function(){y(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else o()}}t.exports=function(t,a){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(a=a||{}).attrs="object"==typeof a.attrs?a.attrs:{},a.singleton||"boolean"==typeof a.singleton||(a.singleton=p()),a.insertInto||(a.insertInto="head"),a.insertAt||(a.insertAt="bottom");var s=d(t,a);return f(s,a),function(t){for(var e=[],n=0;n<s.length;n++){var r=s[n];(o=u[r.id]).refs--,e.push(o)}t&&f(d(t,a),a);for(n=0;n<e.length;n++){var o;if(0===(o=e[n]).refs){for(var i=0;i<o.parts.length;i++)o.parts[i]();delete u[o.id]}}}};var v,b=(v=[],function(t,e){return v[t]=e,v.filter(Boolean).join("\n")});function I(t,e,n,r){var o=n?"":r.css;if(t.styleSheet)t.styleSheet.cssText=b(e,o);else{var i=document.createTextNode(o),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(i,a[e]):t.appendChild(i)}}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var o=e.protocol+"//"+e.host,i=o+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var n,r=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(r)?t:(n=0===r.indexOf("//")?r:0===r.indexOf("/")?o+r:i+r.replace(/^\.\//,""),"url("+JSON.stringify(n)+")")})}},function(t,e,n){"use strict";n.r(e);var r=n(1),o=n.n(r),i=(n(2),!1);function a(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];i&&console.log.apply(null,t)}var s,u,p,c=(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),l=function(n){function t(t){var e=n.call(this,t)||this;return e.name="CustomError",e}return c(t,n),t.prototype.toString=function(){var t="#"+this.name+": "+this.message;for(var e in this)"name"!==e&&(t+="\n"+e+": "+this[e].toString());return t},t}(Error);function m(t){if(!t)return t;var e=/^[^　\S]*([\s\S]*?)\s*$/.exec(t);return e?e[1]:t}function f(t){var e=parseInt(t,10);return t!==e+""?null:e}(p=u||(u={}))[p.Briefer=0]="Briefer",p[p.Brief=1]="Brief",p[p.Detailed=2]="Detailed",p[p.Sengen=3]="Sengen";var d,h,y=u,g=function(){function t(){var e=this;this.callbacks_=[],this.mode_=t.loadThenApply(),t.$selPastaOutputFormat.on("change input",function(t){e.read().save(),e.callbacks_.forEach(function(t){return t(e.mode)})})}return t.applySelectValue=function(t){this.$selPastaOutputFormat.val(t)},t.loadThenApply=function(){var t=localStorage.getItem("ISP_OutputFormat"),e=y.Brief;return t&&(e=parseInt(t,10)),this.apply(e),e},t.save=function(t){localStorage.setItem("ISP_OutputFormat",t+"")},t.read=function(){return parseInt(this.$selPastaOutputFormat.val(),10)},t.apply=function(t){this.$selPastaOutputFormat.val(t)},Object.defineProperty(t,"$selPastaOutputFormat",{get:function(){return this.$selPastaOutputFormat_||$("#ISP_OutputFormat")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){return this.mode_},set:function(t){this.mode_=t},enumerable:!0,configurable:!0}),t.prototype.save=function(){return t.save(this.mode_),this},t.prototype.read=function(){return this.mode_=t.read(),this},t.prototype.apply=function(){return t.apply(this.mode_),this},t.prototype.bind=function(t){return this.callbacks_.push(t),this},t.prototype.unbind=function(e){return this.callbacks_=this.callbacks_.filter(function(t){return t!==e}),this},t.defaultPastaFormat=y.Brief,t}();(h=d||(d={}))[h.None=0]="None",h[h.Equipment=1]="Equipment",h[h.Enchantment=2]="Enchantment",h[h.Composition=3]="Composition",h[h.Food=4]="Food";var N,_,v,b,I,w,E,P,x,O,S,R,j,A,T,B,C,F,k=d,U=(N=function(t,e){return(N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}N(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),V=function(n){function t(t){var e=n.call(this,t)||this;return e.name="ProductionTypeIsNotSetError",e}return U(t,n),t}(l),L=n(0),D=n.n(L),M=function(){function s(t,e){void 0===t&&(t=""),void 0===e&&(e=[]),this.fullname=t,this.itemNames=e}return s.load=function(o){var i=this,a=D.a.Deferred();return this.infoArray.hasOwnProperty(o)?a.resolve(this.infoArray[o]):D.a.get("http://lisge.com/ib/k/now/r"+o+".html",void 0,void 0,"text").done(function(t){var e=D()(t,i.virtualDoc),n=e.find(".CSEAT>.CNM").text(),r=e.find("img[src='../../p/t_item.png'] ~ table[width='860'] tr:nth-of-type(n+2) > td:nth-of-type(2)").toArray().map(function(t,e){var n=t.textContent;return n=" "===n?"":n});r.unshift(""),i.infoArray[o]=new s(n,r),a.resolve(i.infoArray[o])}).fail(function(){i.infoArray[o]=new s,a.resolve(i.infoArray[o])}),a.promise()},s.getCachedInfo=function(t){return this.infoArray[t]||new s},s.infoArray=[],s.virtualDoc=document.implementation.createHTMLDocument(),s}(),W=function(){function t(t){if(this.eno=t.eno,this.productionType=t.productionType,this.productionType===k.None)throw new V}return t.tryParse=function(t,e){throw new l},t.prototype.generateNamedPasta=function(e){var n=this;return M.load(this.eno).then(function(t){switch(t=t,e){case y.Briefer:return n.generatePasta_Briefer(t);case y.Brief:return n.generatePasta_Brief(t);case y.Detailed:return n.generatePasta_Detailed(t);case y.Sengen:return n.generatePasta_Sengen(t)}})},t.prototype.generatePasta=function(t){var e=M.getCachedInfo(this.eno);switch(t){case y.Briefer:return this.generatePasta_Briefer(e);case y.Brief:return this.generatePasta_Brief(e);case y.Detailed:return this.generatePasta_Detailed(e);case y.Sengen:return this.generatePasta_Sengen(e)}},t.maxItemNameChars=16,t}(),q=(_=function(t,e){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}_(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),H=function(n){function t(t){var e=n.call(this,t)||this;return e.category=t.category,e}return q(t,n),t}(W),G=function(){function t(t){this.names_=null,this.optionValues_=null,this.select=t}return Object.defineProperty(t.prototype,"select",{set:function(t){var e=D()(t).find("option");this.names_=e.toArray().map(function(t,e){return t.textContent}),this.optionValues_=e.toArray().map(function(t,e){return t.value})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"names",{get:function(){if(!this.names_)throw new l("配列names_が初期化されていません。this.Selectが指定されていないことが原因のようです。");return this.names_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){if(!this.optionValues_)throw new l("配列optionValues_が初期化されていません。this.Selectが指定されていないことが原因のようです。");return this.optionValues_},enumerable:!0,configurable:!0}),t.prototype.getOption=function(t){return{Name:this.names[t],Value:this.values[t]}},t.prototype.getOptionFromValue=function(t){var e=this.values.indexOf(t);if(-1===e)throw new l("入力値 "+t+" に一致する値がSelect > Option.valueの一覧にありませんでした。");return this.getOption(e)},t.prototype.getOptionFromName=function(t){var e=this.names.indexOf(t);if(-1===e)throw new l("入力値 "+t+" に一致する値がSelect > Option.textContentの一覧にありませんでした。");return this.getOption(e)},t}(),J=(v=function(t,e){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}v(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Y=function(r){function t(t,e){var n=r.call(this,e)||this;return n.ENoText=t,n.name="InvalidENoError",n}return J(t,r),t}(l),z=(b=function(t,e){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}b(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),K=function(r){function t(t,e){var n=r.call(this,e)||this;return n.ItemNumberText=t,n.name="InvalidItemNumberError",n}return z(t,r),t}(l),Q=(I=function(t,e){return(I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}I(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),X=function(r){function t(t,e){var n=r.call(this,e)||this;return n.ItemName=t,n.name="ItemNameTooLongError",n}return Q(t,r),t}(l),Z=function(){function t(){}return t.$enoInput=function(t){return D()("input[name='dt_seieno"+t+"']")},t.$productionTypeSelect=function(t){return D()("select[name='dt_seisan"+t+"']")},t.extractProductionType=function(t){return this.productionTypeOptionValues.indexOf(this.$productionTypeSelect(t).val())},t.extractProductionNumber=function(t){var e=t.getAttribute("name");if(null===e)throw new l("Elementに名前が存在しません。不正なElementが入力されたようです。");var n=/dt_\D+(\d+)/.exec(e);if(!n)throw new l("Elementの名前最後部に数字が存在しません。不正なElementが入力されたようです。");var r=parseInt(n[1],10);if(isNaN(r))throw new l("生産枠番号が正常に取得できませんでした。");return r},t.isInputValueError=function(t){return"InvalidENoError"===t.name||"InvalidItemNumberError"===t.name||"ItemNameTooLongError"===t.name},t.extractProduction=function(t){var e=this.extractAndValidateENo(t);if(null===e)return null;var n=this.extractProductionType(t);return null===n||n===k.None?null:{eno:e,productionType:n}},t.parseAndValidateItemNumber=function(t){var e=f(m(t));if(""!==t&&null===e)throw new K(t);return e},t.validateItemNameLength=function(t){var e=m(t);if(0===e.length)return null;if(16<e.length)throw new X(e);return e},t.extractAndValidateENo=function(t){var e=m(this.$enoInput(t).val()),n=f(e);if(""!==e&&null===n)throw new Y(e);return n},t.productionTypeOptionValues=t.$productionTypeSelect(1).find("option").toArray().map(function(t,e){return t.value}),t}(),tt=(w=function(t,e){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}w(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),et=function(a){function t(){return null!==a&&a.apply(this,arguments)||this}return tt(t,a),t.$itemNum1Input=function(t){return D()("input[name='dt_sakuA"+t+"']")},t.$categorySelect=function(t){return D()("select[name='dt_sakuB"+t+"']")},t.$itemNameInput=function(t){return D()("input[name='dt_sakuC"+t+"']")},t.$weaponRangeSelect=function(t){return D()("select[name='dt_sakuD"+t+"']")},t.extractProduction=function(t){var e=a.extractProduction.call(this,t);if(!e||e.productionType!==k.Equipment)return null;var n=a.parseAndValidateItemNumber.call(this,this.$itemNum1Input(t).val());if(null===n)return null;var r=this.categories.getOptionFromValue(this.$categorySelect(t).val()),o=a.validateItemNameLength.call(this,this.$itemNameInput(t).val());if(null===o)return null;var i=parseInt(this.$weaponRangeSelect(t).val(),10);return new rt({eno:e.eno,productionType:k.Equipment,itemNum1:n,category:r,itemName:o,weaponRange:i})},t.updateNameCharsCounter=function(t){this.$itemNameInput(t).trigger("keyup")},t.categories=new G(t.$categorySelect(1)[0]),t.validWeaponRanges=new G(t.$weaponRangeSelect(1)[0]),t}(Z),nt=(E=function(t,e){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}E(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),rt=function(n){function t(t){var e=n.call(this,t)||this;return e.itemNum1=t.itemNum1,e.itemName=t.itemName,e.weaponRange=t.weaponRange,e}return nt(t,n),t.tryParse=function(t,e){var n=this.parserRegExp1.exec(e)||this.parserRegExp2.exec(e)||this.parserRegExpOfficial.exec(e);if(!n)return null;void 0===n[5]?parseInt(et.validWeaponRanges.values[0],10):parseInt(n[5],10);return new this({eno:parseInt(n[1],10),productionType:k.Equipment,itemNum1:parseInt(n[2],10),category:et.categories.getOptionFromName(n[3]),itemName:n[4],weaponRange:void 0===n[5]?1:parseInt(n[5],10)})},t.prototype.generatePasta_Briefer=function(t){var e;switch(this.category.Name){case"武器":e="射程"+this.weaponRange;break;case"防具":case"装飾":e="";break;default:e="射程"+this.weaponRange}var n=["[作製]"+this.eno,""+this.itemNum1,this.category.Name,m(this.itemName)];return e&&n.push(e),n.join("/")},t.prototype.generatePasta_Brief=function(t){var e;switch(this.category.Name){case"武器":e="射程"+this.weaponRange;break;case"防具":case"装飾":e="";break;default:e="武器なら射程"+this.weaponRange}var n=["[装備作製]ENo."+this.eno,"ItemNo."+this.itemNum1,this.category.Name,m(this.itemName)];return e&&n.push(e),n.join("/")},t.prototype.generatePasta_Detailed=function(t){var e;switch(this.category.Name){case"武器":e="、射程"+this.weaponRange;break;case"防具":case"装飾":e="";break;default:e="、(武器なら)射程"+this.weaponRange}var n="[装備作製]ENo."+this.eno+" "+t.fullname+"のItemNo."+this.itemNum1+"("+(t.itemNames[this.itemNum1]||"")+")から"+this.category.Name+"を作製、名前は "+m(this.itemName);return e&&(n+=e),n},t.prototype.generatePasta_Sengen=function(t){var e;switch(this.category.Name){case"武器":e=" 〈射程〉"+this.weaponRange;break;case"防具":case"装飾":e="";break;default:e=" 〈(武器なら)射程〉"+this.weaponRange}var n="［装備作製］"+t.fullname+"("+this.eno+") の所持する ItemNo."+this.itemNum1+"（"+(t.itemNames[this.itemNum1]||"")+"）から "+this.category.Name+" を作製\n　　└〈装備名〉"+m(this.itemName);return e&&(n+=e),n},t.parserRegExp1=new RegExp("^\\s*(?:[^\\/]?(?:装備)?作製[^\\d\\/]? ?)?(?:ENo\\.)?\\s??(\\d+)\\/(?:ItemNo\\.)?\\s??(\\d+)\\/("+et.categories.names.join("|")+")\\/[^　\\S]*(\\S.*?)\\s*(?:\\/(?:\\(?武器(?:なら)?\\)?)?射程\\s??("+et.validWeaponRanges.values.join("|")+"))?\\s*$","i"),t.parserRegExp2=new RegExp("^\\s*(?:[^\\/]?(?:装備)?作製[^\\d\\/]? ?)?(?:ENo\\.)?\\s??(\\d+)\\s??の\\s??(?:ItemNo\\.)?\\s??(\\d+)(?:\\s?\\(.*?\\))?\\s??から\\s??("+et.categories.names.join("|")+")\\s??(?:を\\s??作製、)?\\s??名前は\\s?[^　\\S]*(\\S.*?)\\s*(?:\\s??、\\s??(?:\\(?武器(?:なら)?\\)?)?射程\\s??("+et.validWeaponRanges.values.join("|")+"))?\\s*$","i"),t.parserRegExpOfficial=new RegExp("^\\s*(?:［?装備作製］ ?)?.*?\\((\\d+)\\) ?の所持する ?ItemNo\\.\\s??(\\d+)\\s??（.*?）\\s??から ?("+et.categories.names.join("|")+") ?を\\s??作製\\s??　?　?└〈装備名〉[^　\\S]*(\\S.*?)\\s*(?: ?〈(?:\\(?武器(?:なら)?\\)?)?射程〉\\s??("+et.validWeaponRanges.values.join("|")+"))?\\s*$","i"),t}(H),ot=(P=function(t,e){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}P(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),it=function(n){function t(t){var e=n.call(this,t)||this;return e.itemNum1=t.itemNum1,e.itemNum2=t.itemNum2,e}return ot(t,n),t.tryParse=function(t,e){var n=this.parserRegExp1.exec(e)||this.parserRegExp12.exec(e)||this.parserRegExp2.exec(e)||this.parserRegExpOfficial1.exec(e);return n?new this({eno:parseInt(n[1],10),productionType:k.Enchantment,itemNum1:parseInt(n[2],10),itemNum2:parseInt(n[3],10)}):null},t.prototype.generatePasta_Briefer=function(t){return["[付加]"+this.eno,""+this.itemNum1,""+this.itemNum2].join("/")},t.prototype.generatePasta_Brief=function(t){return["[効果付加]ENo."+this.eno,"ItemNo."+this.itemNum1,"ItemNo."+this.itemNum2].join("/")},t.prototype.generatePasta_Detailed=function(t){return"[効果付加]ENo."+this.eno+" "+t.fullname+"のItemNo."+this.itemNum1+"("+(t.itemNames[this.itemNum1]||"")+")にItemNo."+this.itemNum2+"("+(t.itemNames[this.itemNum2]||"")+")を付加"},t.prototype.generatePasta_Sengen=function(t){return"［効果付加］"+t.fullname+"("+this.eno+") の所持する ItemNo."+this.itemNum1+"（"+(t.itemNames[this.itemNum1]||"")+"）に ItemNo."+this.itemNum2+"（"+(t.itemNames[this.itemNum2]||"")+"）を付加"},t.parserRegExp1=new RegExp("^\\s*[^\\/]?(?:効果)?付加[^\\d\\/]? ?(?:ENo\\.)?\\s??(\\d+)\\/(?:ItemNo\\.)?\\s??(\\d+)\\/(?:ItemNo\\.)?\\s??(\\d+)\\s*$","i"),t.parserRegExp12=new RegExp("^\\s*(?:ENo\\.)?\\s??(\\d+)\\/(?:ItemNo\\.)?\\s??(\\d+)\\/(?:ItemNo\\.)?\\s??(\\d+)\\/付加\\s*$","i"),t.parserRegExp2=new RegExp("^\\s*[^\\/]?(?:効果)?付加[^\\d\\/]? ?(?:ENo\\.)?\\s??(\\d+)\\s??の\\s??(?:ItemNo\\.)?\\s??(\\d+)(?:\\s?\\(.*?\\))?\\s??に\\s??(?:ItemNo\\.)?\\s??(\\d+)(?:\\s?\\(.*?\\))?\\s??(?:を\\s??付加)?\\s*$","i"),t.parserRegExp22=new RegExp("^\\s*(?:ENo\\.)?\\s??(\\d+)\\s??の\\s??(?:ItemNo\\.)?\\s??(\\d+)(?:\\s?\\(.*?\\))?\\s??に\\s??(?:ItemNo\\.)?\\s??(\\d+)(?:\\s?\\(.*?\\))?\\s??を\\s??付加\\s*$","i"),t.parserRegExpOfficial1=new RegExp("^\\s*［?(?:効果)?付加］.*?\\((\\d+)\\) ?の所持する ?ItemNo\\.\\s??(\\d+)\\s??（.*?）\\s??に ?ItemNo\\.\\s??(\\d+)\\s??（.*?）\\s??(?:を\\s??付加)?\\s*$","i"),t.parserRegExpOfficial112=new RegExp("^\\s*.*?\\((\\d+)\\) ?の所持する ?ItemNo\\.\\s??(\\d+)\\s??（.*?）\\s??に ?ItemNo\\.\\s??(\\d+)\\s??（.*?）\\s??(?:を\\s??付加)?\\s*$","i"),t}(W),at=(x=function(t,e){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}x(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),st=function(i){function t(){return null!==i&&i.apply(this,arguments)||this}return at(t,i),t.$itemNum1Input=function(t){return D()("input[name='dt_goseiA"+t+"']")},t.$itemNum2Input=function(t){return D()("input[name='dt_goseiB"+t+"']")},t.$categorySelect=function(t){return D()("select[name='dt_goseiC"+t+"']")},t.extractProduction=function(t){var e=i.extractProduction.call(this,t);if(!e||e.productionType!==k.Composition)return null;var n=i.parseAndValidateItemNumber.call(this,this.$itemNum1Input(t).val()),r=i.parseAndValidateItemNumber.call(this,this.$itemNum2Input(t).val());if(null===n||null===r)return null;var o=this.categories.getOptionFromValue(this.$categorySelect(t).val());return new pt({eno:e.eno,productionType:k.Composition,itemNum1:n,itemNum2:r,category:o})},t.categories=new G(t.$categorySelect(1)[0]),t}(Z),ut=(O=function(t,e){return(O=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}O(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),pt=function(n){function t(t){var e=n.call(this,t)||this;return e.itemNum1=t.itemNum1,e.itemNum2=t.itemNum2,e}return ut(t,n),t.tryParse=function(t,e){var n=this.parserRegExp1.exec(e)||this.parserRegExp2.exec(e)||this.parserRegExpOfficial1.exec(e);if(n)return new this({eno:parseInt(n[2],10),productionType:k.Composition,itemNum1:parseInt(n[3],10),itemNum2:parseInt(n[4],10),category:st.categories.getOptionFromName(n[1])});var r=this.parserRegExp12.exec(e)||this.parserRegExp22.exec(e)||this.parserRegExpOfficial2.exec(e);return r?new this({eno:parseInt(r[1],10),productionType:k.Composition,itemNum1:parseInt(r[2],10),itemNum2:parseInt(r[3],10),category:st.categories.getOptionFromName(r[4])}):null},t.prototype.generatePasta_Briefer=function(t){return["["+this.category.Name+"]"+this.eno,""+this.itemNum1,""+this.itemNum2].join("/")},t.prototype.generatePasta_Brief=function(t){return["["+this.category.Name+"]ENo."+this.eno,"ItemNo."+this.itemNum1,"ItemNo."+this.itemNum2].join("/")},t.prototype.generatePasta_Detailed=function(t){return"["+this.category.Name+"]ENo."+this.eno+" "+t.fullname+"のItemNo."+this.itemNum1+"("+(t.itemNames[this.itemNum1]||"")+")にItemNo."+this.itemNum2+"("+(t.itemNames[this.itemNum2]||"")+")を"+this.category.Name},t.prototype.generatePasta_Sengen=function(t){return"［"+this.category.Name+"］"+t.fullname+"("+this.eno+") の所持する ItemNo."+this.itemNum1+"（"+(t.itemNames[this.itemNum1]||"")+"）に ItemNo."+this.itemNum2+"（"+(t.itemNames[this.itemNum2]||"")+"）を"+this.category.Name},t.parserRegExp1=new RegExp("^\\s*[^\\/]?("+st.categories.names.join("|")+")[^\\d\\/]? ?(?:ENo\\.)?\\s??(\\d+)\\/(?:ItemNo\\.)?\\s??(\\d+)\\/(?:ItemNo\\.)?\\s??(\\d+)(?:\\/(?:"+st.categories.names.join("|")+"))?\\s*$","i"),t.parserRegExp12=new RegExp("^\\s*(?:ENo\\.)?\\s??(\\d+)\\/(?:ItemNo\\.)?\\s??(\\d+)\\/(?:ItemNo\\.)?\\s??(\\d+)\\/("+st.categories.names.join("|")+")\\s*$","i"),t.parserRegExp2=new RegExp("^\\s*[^\\/]?("+st.categories.names.join("|")+")[^\\d\\/]? ?(?:ENo\\.)?\\s??(\\d+)\\s??の\\s??(?:ItemNo\\.)?\\s??(\\d+)(?:\\s?\\(.*?\\))?\\s??に\\s??(?:ItemNo\\.)?\\s??(\\d+)(?:\\s?\\(.*?\\))?\\s??(?:を\\s??(?:"+st.categories.names.join("|")+"))?\\s*$","i"),t.parserRegExp22=new RegExp("^\\s*(?:ENo\\.)?\\s??(\\d+)\\s??の\\s??(?:ItemNo\\.)?\\s??(\\d+)(?:\\s?\\(.*?\\))?\\s??に\\s??(?:ItemNo\\.)?\\s??(\\d+)(?:\\s?\\(.*?\\))?\\s??を\\s??("+st.categories.names.join("|")+")\\s*$","i"),t.parserRegExpOfficial1=new RegExp("^\\s*［?("+st.categories.names.join("|")+")］.*?\\((\\d+)\\) ?の所持する ?ItemNo\\.\\s??(\\d+)\\s??（.*?）\\s??に ?ItemNo\\.\\s??(\\d+)\\s??（.*?）\\s??(?:を\\s??(?:"+st.categories.names.join("|")+"))?\\s*$","i"),t.parserRegExpOfficial2=new RegExp("^\\s*.*?\\((\\d+)\\) ?の所持する ?ItemNo\\.\\s??(\\d+)\\s??（.*?）\\s??に ?ItemNo\\.\\s??(\\d+)\\s??（.*?）\\s??を\\s??("+st.categories.names.join("|")+")\\s*$","i"),t}(H),ct=(S=function(t,e){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}S(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),lt=function(i){function t(){return null!==i&&i.apply(this,arguments)||this}return ct(t,i),t.$itemNum1Input=function(t){return D()("input[name='dt_ryoriA"+t+"']")},t.$categorySelect=function(t){return D()("select[name='dt_ryoriB"+t+"']")},t.$itemNameInput=function(t){return D()("input[name='dt_ryoriC"+t+"']")},t.extractProduction=function(t){var e=i.extractProduction.call(this,t);if(!e||e.productionType!==k.Food)return null;var n=i.parseAndValidateItemNumber.call(this,this.$itemNum1Input(t).val());if(null===n)return null;var r=this.categories.getOptionFromValue(this.$categorySelect(t).val()),o=i.validateItemNameLength.call(this,this.$itemNameInput(t).val());return null===o?null:new ft({eno:e.eno,productionType:k.Food,itemNum1:n,category:r,itemName:o})},t.updateNameCharsCounter=function(t){this.$itemNameInput(t).trigger("keyup")},t.categories=new G(t.$categorySelect(1)[0]),t}(Z),mt=(R=function(t,e){return(R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}R(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),ft=function(n){function t(t){var e=n.call(this,t)||this;return e.itemNum1=t.itemNum1,e.itemName=t.itemName,e}return mt(t,n),t.tryParse=function(t,e){var n=this.parserRegExp1.exec(e)||this.parserRegExp2.exec(e)||this.parserRegExpOfficial.exec(e);return n?new this({eno:parseInt(n[1],10),productionType:k.Food,itemNum1:parseInt(n[2],10),category:lt.categories.getOptionFromName(n[3]),itemName:n[4]}):null},t.prototype.generatePasta_Briefer=function(t){return["[料理]"+this.eno,""+this.itemNum1,this.category.Name,m(this.itemName)].join("/")},t.prototype.generatePasta_Brief=function(t){return["[料理]ENo."+this.eno,"ItemNo."+this.itemNum1,this.category.Name,m(this.itemName)].join("/")},t.prototype.generatePasta_Detailed=function(t){return"[料理]ENo."+this.eno+" "+t.fullname+"のItemNo."+this.itemNum1+"("+(t.itemNames[this.itemNum1]||"")+")から"+this.category.Name+"を作製、名前は "+m(this.itemName)},t.prototype.generatePasta_Sengen=function(t){return"［料理］"+t.fullname+"("+this.eno+") の所持する ItemNo."+this.itemNum1+"（"+(t.itemNames[this.itemNum1]||"")+"）から "+this.category.Name+" を作製\n　　└〈料理名〉"+m(this.itemName)},t.parserRegExp1=new RegExp("^\\s*(?:[^\\/]?料理[^\\d\\/]? ?)?(?:ENo\\.)?\\s??(\\d+)\\/(?:ItemNo\\.)?\\s??(\\d+)\\/("+lt.categories.names.join("|")+")\\/[^　\\S]*(\\S.*?)\\s*$","i"),t.parserRegExp2=new RegExp("^\\s*(?:[^\\/]?料理[^\\d\\/]? ?)?(?:ENo\\.)?\\s??(\\d+)\\s??の\\s??(?:ItemNo\\.)?\\s??(\\d+)(?:\\s?\\(.*?\\))?\\s??から\\s??("+lt.categories.names.join("|")+")\\s??(?:を\\s??作製、)?\\s??名前は\\s?[^　\\S]*(\\S.*?)\\s*$","i"),t.parserRegExpOfficial=new RegExp("^\\s*(?:［?料理］ ?)?.*?\\((\\d+)\\) ?の所持する ?ItemNo\\.\\s??(\\d+)\\s??（.*?）\\s??から ?("+lt.categories.names.join("|")+") ?を\\s??作製\\s??　?　?└〈料理名〉[^　\\S]*(\\S.*?)\\s*$","i"),t}(H),dt=function(){function t(t,e){void 0===e&&(e=null),this.prod_=e,this.ProductionNumber=t,this.enoInput_=Z.$enoInput(t)[0],this.productionTypeSelect_=Z.$productionTypeSelect(t)[0]}return Object.defineProperty(t.prototype,"production",{get:function(){return this.prod_},enumerable:!0,configurable:!0}),t.prototype.applyToInputs=function(){this.production&&(this.enoInput_.value=this.production.eno+"",this.productionTypeSelect_.value=Z.productionTypeOptionValues[this.production.productionType])},t.prototype.bind=function(t,e,n){var r=this,o=D()(this.enoInput_).add(this.productionTypeSelect_);n&&(o=o.add(n)),o.on(t,function(){e(r)})},t.prototype.unbind=function(t,e){var n=D()(this.enoInput_).add(this.productionTypeSelect_);e&&(n=n.add(e)),n.unbind(t)},t}(),ht=(j=function(t,e){return(j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}j(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),yt=function(r){function t(t,e){void 0===e&&(e=null);var n=r.call(this,t,e)||this;return n.itemNum1Input_=et.$itemNum1Input(t)[0],n.categorySelect_=et.$categorySelect(t)[0],n.itemNameInput_=et.$itemNameInput(t)[0],n.weaponRangeSelect_=et.$weaponRangeSelect(t)[0],n}return ht(t,r),Object.defineProperty(t.prototype,"production",{get:function(){return this.prod_},enumerable:!0,configurable:!0}),t.prototype.updateFromInputs=function(){try{this.prod_=et.extractProduction(this.ProductionNumber)}catch(t){throw et.isInputValueError(t)&&(this.prod_=null),t}},t.prototype.applyToInputs=function(){r.prototype.applyToInputs.call(this),this.production&&(this.itemNum1Input_.value=this.production.itemNum1+"",this.itemNameInput_.value=this.production.itemName,this.categorySelect_.value=this.production.category.Value,this.weaponRangeSelect_.value=this.production.weaponRange+"",et.updateNameCharsCounter(this.ProductionNumber))},t.prototype.bind=function(t,e){var n=D()(this.itemNum1Input_).add(this.categorySelect_).add(this.itemNameInput_).add(this.weaponRangeSelect_);r.prototype.bind.call(this,t,e,n)},t.prototype.unbind=function(t){var e=D()(this.itemNum1Input_).add(this.categorySelect_).add(this.itemNameInput_).add(this.weaponRangeSelect_);r.prototype.unbind.call(this,t,e)},t}(dt),gt=(A=function(t,e){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}A(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Nt=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return gt(t,o),t.$itemNum1Input=function(t){return D()("input[name='dt_hukaA"+t+"']")},t.$itemNum2Input=function(t){return D()("input[name='dt_hukaB"+t+"']")},t.extractProduction=function(t){var e=o.extractProduction.call(this,t);if(!e||e.productionType!==k.Enchantment)return null;var n=o.parseAndValidateItemNumber.call(this,this.$itemNum1Input(t).val()),r=o.parseAndValidateItemNumber.call(this,this.$itemNum2Input(t).val());return null===n||null===r?null:new it({eno:e.eno,productionType:k.Enchantment,itemNum1:n,itemNum2:r})},t}(Z),_t=(T=function(t,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}T(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),vt=function(r){function t(t,e){void 0===e&&(e=null);var n=r.call(this,t,e)||this;return n.itemNum1Input_=Nt.$itemNum1Input(t)[0],n.itemNum2Input_=Nt.$itemNum2Input(t)[0],n}return _t(t,r),Object.defineProperty(t.prototype,"production",{get:function(){return this.prod_},enumerable:!0,configurable:!0}),t.prototype.updateFromInputs=function(){try{this.prod_=Nt.extractProduction(this.ProductionNumber)}catch(t){throw Nt.isInputValueError(t)&&(this.prod_=null),t}},t.prototype.applyToInputs=function(){r.prototype.applyToInputs.call(this),this.production&&(this.itemNum1Input_.value=this.production.itemNum1+"",this.itemNum2Input_.value=this.production.itemNum2+"")},t.prototype.bind=function(t,e){var n=D()(this.itemNum1Input_).add(this.itemNum2Input_);r.prototype.bind.call(this,t,e,n)},t.prototype.unbind=function(t){var e=D()(this.itemNum1Input_).add(this.itemNum2Input_);r.prototype.unbind.call(this,t,e)},t}(dt),bt=(B=function(t,e){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}B(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),It=function(r){function t(t,e){void 0===e&&(e=null);var n=r.call(this,t,e)||this;return n.itemNum1Input_=st.$itemNum1Input(t)[0],n.itemNum2Input_=st.$itemNum2Input(t)[0],n.methodSelect_=st.$categorySelect(t)[0],n}return bt(t,r),Object.defineProperty(t.prototype,"production",{get:function(){return this.prod_},enumerable:!0,configurable:!0}),t.prototype.updateFromInputs=function(){try{this.prod_=st.extractProduction(this.ProductionNumber)}catch(t){throw st.isInputValueError(t)&&(this.prod_=null),t}},t.prototype.applyToInputs=function(){r.prototype.applyToInputs.call(this),this.production&&(this.itemNum1Input_.value=this.production.itemNum1+"",this.itemNum2Input_.value=this.production.itemNum2+"",this.methodSelect_.value=this.production.category.Value)},t.prototype.bind=function(t,e){var n=D()(this.itemNum1Input_).add(this.itemNum2Input_).add(this.methodSelect_);r.prototype.bind.call(this,t,e,n)},t.prototype.unbind=function(t){var e=D()(this.itemNum1Input_).add(this.itemNum2Input_).add(this.methodSelect_);r.prototype.unbind.call(this,t,e)},t}(dt),wt=(C=function(t,e){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}C(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Et=function(r){function t(t,e){void 0===e&&(e=null);var n=r.call(this,t,e)||this;return n.itemNum1Input_=lt.$itemNum1Input(t)[0],n.categorySelect_=lt.$categorySelect(t)[0],n.itemNameInput_=lt.$itemNameInput(t)[0],n}return wt(t,r),Object.defineProperty(t.prototype,"production",{get:function(){return this.prod_},enumerable:!0,configurable:!0}),t.prototype.updateFromInputs=function(){try{this.prod_=lt.extractProduction(this.ProductionNumber)}catch(t){throw lt.isInputValueError(t)&&(this.prod_=null),t}},t.prototype.applyToInputs=function(){r.prototype.applyToInputs.call(this),this.production&&(this.itemNum1Input_.value=this.production.itemNum1+"",this.itemNameInput_.value=this.production.itemName,this.categorySelect_.value=this.production.category.Value,lt.updateNameCharsCounter(this.ProductionNumber))},t.prototype.bind=function(t,e){var n=D()(this.itemNum1Input_).add(this.categorySelect_).add(this.itemNameInput_);r.prototype.bind.call(this,t,e,n)},t.prototype.unbind=function(t){var e=D()(this.itemNum1Input_).add(this.categorySelect_).add(this.itemNameInput_);r.prototype.unbind.call(this,t,e)},t}(dt),Pt=(F=function(t,e){return(F=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}F(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),xt=function(r){function t(t,e){var n=r.call(this,e)||this;return n.Pasta=t,n.name="InvalidPastaError",n}return Pt(t,r),t}(l);new(function(){function i(){var e=this;this.forms=[],this.$seisanpastaBox=[],i.insertInfoBar(),this.modeSelector=new g,this.bindEventsAndExtractForms(),this.modeSelector.bind(function(t){return e.triggerAllUpdatingEvent()})}return i.triggerUpdatingEvent=function(t){a("triggering updating event"),D()(t.target).trigger(i.FormUpdatingEventName)},i.buildEmptyForm=function(t){var e=Z.extractProductionType(t);switch(e){case k.None:return null;case k.Equipment:return new yt(t);case k.Enchantment:return new vt(t);case k.Composition:return new It(t);case k.Food:return new Et(t);default:throw new l("生産種を正常に取得できませんでした。("+e+")")}},i.newFormFromPasta=function(t,e){var n=rt.tryParse(t,e)||it.tryParse(t,e)||pt.tryParse(t,e)||ft.tryParse(t,e);if(!n)throw new xt(e);switch(n.productionType){case k.Equipment:return new yt(t,n);case k.Enchantment:return new vt(t,n);case k.Composition:return new It(t,n);case k.Food:return new Et(t,n);default:throw new l("")}},i.insertInfoBar=function(){D()(".G3:contains(各種生産行動)").nextUntil("br").after(o.a)},Object.defineProperty(i,"$btnPastaWithItemNames",{get:function(){return D()("#ISP_BtnItemNames")},enumerable:!0,configurable:!0}),i.prototype.bindEventsAndExtractForms=function(){var e=this;D()("input[name^='dt_seieno']").on("paste",function(t){return e.enoInputOnPasting(t)}),D()("input[name^='dt_seieno']").add("input[name^='dt_sakuA']").add("input[name^='dt_sakuC']").add("input[name^='dt_hukaA']").add("input[name^='dt_hukaB']").add("input[name^='dt_goseiA']").add("input[name^='dt_goseiB']").add("input[name^='dt_ryoriA']").add("input[name^='dt_ryoriC']").keyup(function(t){return i.triggerUpdatingEvent(t)}),D()("select[name^='dt_sakuB']").add("select[name^='dt_sakuD']").add("select[name^='dt_goseiC']").add("select[name^='dt_ryoriB']").change(function(t){return i.triggerUpdatingEvent(t)}),D()("select[name^='dt_seisan']").change(function(t){return e.productionTypeOnChange(t)}).trigger("change"),i.$btnPastaWithItemNames.on("click touchend",function(t){t.preventDefault(),e.triggerAllUpdatingWithNamedPastaEvent()})},i.prototype.triggerAllUpdatingEvent=function(){var e=this;this.forms.filter(function(t){return t}).forEach(function(t){return e.updatingEvent(t)})},i.prototype.triggerAllUpdatingWithNamedPastaEvent=function(){var e=this;this.forms.filter(function(t){return t}).forEach(function(t){return e.updatingWithNamedPastaEvent(t)})},i.prototype.updatingEvent=function(e){try{e.updateFromInputs()}catch(t){return void this.processAndShowUniqueErrors(e.ProductionNumber,t)}a("Processing "+i.FormUpdatingEventName+" Event...",e),this.updatePastaBox(e)},i.prototype.updatingWithNamedPastaEvent=function(e){var n=this;try{e.updateFromInputs()}catch(t){return void this.processAndShowUniqueErrors(e.ProductionNumber,t)}a("Processing "+i.FormUpdatingEventName+" with named pasta Event...",e),(e.production?e.production.generateNamedPasta(this.modeSelector.mode):D.a.Deferred().resolve("").promise()).then(function(t){n.updatePastaBox(e,t)})},i.prototype.processAndShowUniqueErrors=function(t,e){var n;if("InvalidENoError"===e.name)n="入力されたENo.が不正です。(入力値: "+e.ENoText+")";else if("InvalidItemNumberError"===e.name)n="入力されたItemNo.が不正です。(入力値: "+e.ItemNumberText+")";else{if("ItemNameTooLongError"!==e.name)throw"ProductionTypeIsNotSetError"===e.name&&(n="重大なエラーが発生しました。 #ProductionTypeIsNotSetError"),e;n="入力されたアイテム名が長すぎます。("+e.ItemName.length+"文字)"}this.showError(t,n)},i.prototype.productionTypeOnChange=function(t){var e=this,n=Z.extractProductionNumber(t.target),r=this.forms[n];r&&r.unbind(i.FormUpdatingEventName);var o=i.buildEmptyForm(n);a("current: ",r,", new: ",o),(this.forms[n]=o)?(o.bind(i.FormUpdatingEventName,function(t){return e.updatingEvent(t)}),this.updatingEvent(o)):this.hidePastaBox(n)},i.prototype.updatePastaBox=function(t,e,n){var r;void 0===n&&(n=!1),"number"==typeof t?r=t:(r=t.ProductionNumber,e||(e=t.production?t.production.generatePasta(this.modeSelector.mode):""));var o=this.$seisanpastaBox[r];if(a("Updating pasta box...",e,o),e){o?o.text(e).show():o=this.$seisanpastaBox[r]=D()('<textarea id="Seisanpasta'+r+'" class="Seisanpasta" readonly="readonly">'+e+"</textarea>").insertBefore("#SAKUSEI"+r).on("click touchend",function(t){if(!D()(this).hasClass("Error")){var e=this.textContent.length;this.setSelectionRange(0,e),document.execCommand("copy"),this.setSelectionRange(e,e)}}).after("<div class='ISP_tooltip'>クリップボードにコピーされました。</div>");var i=(o.html().match(/\n/g)||[]).length+1;o.css("height",18*i+"px"),n?o.addClass("Error"):o.removeClass("Error")}else this.hidePastaBox(r)},i.prototype.showError=function(t,e){if(!e)throw new l("エラーメッセージが指定されていません。");this.updatePastaBox(t,e,!0)},i.prototype.hidePastaBox=function(t){var e=this.$seisanpastaBox[t];e&&e.hide()},i.prototype.enoInputOnPasting=function(t){var e=t.originalEvent.clipboardData.getData("text/plain"),n=e.replace(/[\r\n]/g,"");if(a("on paste;",e,n),null===f(m(n))&&(t.preventDefault(),""!==n)){var r,o=Z.extractProductionNumber(t.target);try{r=i.newFormFromPasta(o,n)}catch(t){if("InvalidPastaError"===t.name)return void window.alert("貼り付けられた次のテキストはパスタとして認識されませんでした。: \n"+e);throw t}r.applyToInputs(),D()("select[name='dt_seisan"+o+"']").trigger("change")}},i.FormUpdatingEventName="ISP_formUpdated",i}())}]);